---
Title: Jul 10, 2020 日誌
Date: Jul 10, 2020
Category: 日誌
Tags: Ubuntu,20.04,nginx,uwsgi,數位簽章,Ubuntu防火牆,ufw
Slug: Jul_10_ 2020
Author: 40723150
---
整理 Jul,7~8 的資料。Ubuntu 20.04、動態網站(nginx、uwsgi)、數位簽章、Ubuntu防火牆(ufw)
<!-- PELICAN_END_SUMMARY -->

##Ubuntu 20.04



##動態網站(nginx、uwsgi)

因為 CMSiMDE 的動態網站需要 flask、flask_cors、bs4 與 lxml 等模組，所以要先確定 Ubuntu 20.04 中的 Python3 已經安裝這些模組：

sudo pip3 install flask flask_cors bs4 lxml

uwsgi 所需模組：

1. 安裝 uwsgi 套件與 Python3 plugin

    sudo apt install uwsgi uwsgi-plugin-python3

2. 安裝 Python 模組 uwsgi

    sudo pip3 install uwsgi


建立 crt 與 key，並修改 Nginx sites-available/default，加入執行 uwsgi 動態網站的設定(/etc/nginx/sites-available/default 附加 server 設定 )：

<pre class="brush: jscript">
server {
  
    listen 9443 ssl;
    listen [::]:9443 ssl;
  
    # 指定 static 所在位置
    location /static {
    alias /home/yen/cad1_site/cmsimde/static/;
    }
  
    location / {
    # 導入 uwsgi_params 設定參數
    include uwsgi_params;
    # 根目錄設為近端的 8080 port 
    uwsgi_pass  127.0.0.1:8080;
    }
  
    ssl_certificate /home/yen/localhost.crt;
    ssl_certificate_key /home/yen/localhost.key;
    #ssl_certificate /etc/letsencrypt/live/cad1.kmol.info/fullchain.pem;
    #ssl_certificate_key /etc/letsencrypt/live/cad1.kmol.info/privkey.pem;
    ssl_session_timeout 5m;
    ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
    ssl_prefer_server_ciphers on;
    try_files $uri $uri/ =404;
}s
</pre>

上述設定的基本概念為：Nginx 設定檔案中, 只要導入 uwsgi_params，其網頁根目錄的資料可以由 uwsgi 網站程式提供。

因為 uwsgi 無 SSL 設置，因此當內部動態網站以 localhost:8080 將資料送交 Nginx 之後, 可以由 Nginx 提供聯外的 SSL 服務。

uwsgi 主機設定

首先確認 CMSiMDE 中 init.py 設定 uwsgi = True，表示動態網站系統要以 uwsgi 模式啟動

接著將利用 uwsgi 啟動模式中的 emperor 選項，每一台主機只要提供一個 .ini 設定檔案，並集中放在某一目錄中，只要在啟動 uwsgi 時，指定該存放 .ini 設定檔案的目錄位置，uwsgi emperor 模式會一一讀取，配合啟動各 uwsgi server。

目前將此一設定目錄放在 /home/yen/uwsgi_ini, 而設定檔案 uwsgi.ini 則放入 uwsgi_ini 目錄中。

uwsgi.ini 配合設為:

##數位簽章

##Ubuntu防火牆(ufw)

